> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.jianshu.com](https://www.jianshu.com/p/70d63d5ff1cc)

     MySQL 的主从复制是一个异步的复制过程（虽然一般情况下感觉是实时的），数据将从一个 MySQL 数据库复制到另一个 MySQL 数据库，在 master 与 Slave 之间实现整个主从复制的过程是有三个线程参与完成的。其中两个线程（SQL 线程和 IO 线程）在 slave 端，另一个线程（I/O 线程）在 master 端。

**复制概述**

    MySQL 内置的复制功能是构建大型、高性能应用程序的基础。将 MySQL 的数据分布到多个系统上去，这种分布的机制，是通过将 MySQL 的某一台主机的数据复制到其它主机（slave）上，并重新执行一遍来实现的。复制过程中一个服务器充当主服务器，而一个或多个服务器充当从服务器。主服务器将更新写入二进制日志文件，并维护文件的一个索引以跟踪日志循环。这些日志可以记录发送到从服务器的更新。当一个从服务器连接主服务器时，它通知主服务器从服务器在日志中读取的最后一次成功更新的位置。从服务器器接收从那时起发生的任何更新，然后封锁并等待主服务器通知新的更新。

    注：当进行复制时，所有对复制中表的更新必须在主服务器上进行。否则，你必须要小心，以避免对主服务器上的表进行的更新与对从服务器上的表的更新之间的冲突。

**MySQL 复制的应用常见场景？**

        1、从服务器作为主服务器的实时数据备份

        2、主从服务器实现读写分离，从服务器实现负载均衡

        3、把多个从服务器根据业务重要性进行拆分访问

**主从复制实现基本原理？**

        1、复制是 MySQL 自带的一项功能，允许服务器将更改从一个服务器的一个实例复制到另一个实例。

        2、主服务器将所有数据和结构更改记录到二进制日志中。

        3、从属服务器从主服务器请求该二进制日志并在本地应用其内容。即通过把主库的 binlog 传送到从库，从新解析应用到从库。

**MySQL 支持的复制类型**

    （1）基于语句的复制：在主服务器上执行的 SQL 语句，在从服务器上执行同样的语句。MySQL 默认采用基于语句的复制，效率比较高。

            一旦发现没法精确复制时，会自动选择基于行的复制。

    （2）基于行的复制：把改变的内容复制过去，而不是把命令在从服务器上执行一遍。从 MySQL5.0 开始支持。

    （3）混合类型复制：默认采用基于语句的复制，一旦发现基于语句无法精确复制时，就会采用基于行的复制。

**复制解决的问题**

1、数据分布（data  distribution）    2、负载均衡（load  balancing）

3、备份（backups）    4、高可用和容错行（high  availability  and  failover）

**复制过程**

![](http://upload-images.jianshu.io/upload_images/12546411-1fea2cdbd5b0e920.png)

1、从库通过手工执行 change  master to 语句连接主库，提供了连接的用户一切条件（user 、password、port、ip），并且让从库知道，二进制日志的起点位置（file 名 position 号）；    start  slave

    2、从库的 IO 线程和主库的 dump 线程建立连接。

    3、从库根据 change  master  to 语句提供的 file 名和 position 号，IO 线程向主库发起 binlog 的请求。

    4、主库 dump 线程根据从库的请求，将本地 binlog 以 events 的方式发给从库 IO 线程。

    5、从库 IO 线程接收 binlog  events，并存放到本地 relay-log 中，传送过来的信息，会记录到 master.info 中

    6、从库 SQL 线程应用 relay-log，并且把应用过的记录到 relay-log.info 中，默认情况下，已经应用过的 relay 会自动被清理 purge

**主从复制状态失败原因？**

    1、主机没启动，或者宕机，检查主库状态。

    2、网络通信问题，使用 ping 命令检查；或使用 shell 命令进行 shell 端登录测试。

    3、防火墙，selinux

    4、复制用户名、密码、端口号、地址有问题，使用 MySQL 命令进行 shell 端登录测试。

    5、MySQL 自动解析，会将连接的 IP 解析成主机名（skip-name-resolve=0）写入 my.cnf 文件即可。

    6、从库 IO 异常关闭，通过 show slave  status\G 进行查看